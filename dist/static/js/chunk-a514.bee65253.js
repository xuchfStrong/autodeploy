(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-a514"],{C4tA:function(e,t,n){},Is5O:function(e,t,n){"use strict";n.d(t,"s",function(){return o}),n.d(t,"q",function(){return l}),n.d(t,"e",function(){return c}),n.d(t,"n",function(){return u}),n.d(t,"c",function(){return d}),n.d(t,"h",function(){return g}),n.d(t,"j",function(){return f}),n.d(t,"k",function(){return h}),n.d(t,"o",function(){return m}),n.d(t,"d",function(){return v}),n.d(t,"p",function(){return p}),n.d(t,"i",function(){return b}),n.d(t,"b",function(){return k}),n.d(t,"m",function(){return _}),n.d(t,"g",function(){return w}),n.d(t,"a",function(){return y}),n.d(t,"l",function(){return O}),n.d(t,"f",function(){return j}),n.d(t,"t",function(){return F}),n.d(t,"r",function(){return L});var r=n("f0Pt"),a=n.n(r),i=n("t3Un"),s=a.a.create({baseURL:""});function o(e){return s({url:"/runtask/",method:"get",params:e})}function l(e){return a.a.create()({baseURL:"",url:"/initserver/",method:"get",params:e})}function c(e){return Object(i.a)({url:"/dashboard/",method:"get",params:e})}function u(e){return Object(i.a)({url:"/getserver/",method:"get",params:e})}function d(e){return Object(i.a)({url:"/addserver/",method:"post",params:e})}function g(e){return Object(i.a)({url:"/delserver/",method:"get",params:e})}function f(e){return Object(i.a)({url:"/editserver/",method:"get",params:e})}function h(e){return Object(i.a)({url:"/getallserver/",method:"get"})}function m(e){return Object(i.a)({url:"/getservice/",method:"get",params:e})}function v(e){return Object(i.a)({url:"/createtask/",method:"get",params:e})}function p(e){return Object(i.a)({url:"/gettask/",method:"get",params:e})}function b(e){return Object(i.a)({url:"/deltask/",method:"get",params:e})}function k(e){return Object(i.a)({url:"/addrepo/",method:"get",params:e})}function _(e){return Object(i.a)({url:"/getrepo/",method:"get"})}function w(e){return Object(i.a)({url:"/delrepo/",method:"get",params:e})}function y(e){return Object(i.a)({url:"/adddb/",method:"get",params:e})}function O(e){return Object(i.a)({url:"/getdb/",method:"get"})}function j(e){return Object(i.a)({url:"/deldb/",method:"get",params:e})}function F(e){return Object(i.a)({url:"/viewlog/",method:"get",params:e})}function L(e){return Object(i.a)({url:"/initstatus/",method:"get"})}},lwmC:function(e,t,n){"use strict";n.r(t);var r=n("Is5O");var a={filters:{statusFilter:function(e){return{Success:"success",Failed:"danger"}[e]}},data:function(){return{loading:!1,runLoading:!1,total:0,page:1,pagesize:10,sels:[],optionsServer:[],optionsService:[],curentTaskStatus:[],createFormVisible:!1,createLoading:!1,createFormRules:{service:[{required:!0,message:"请选择服务",trigger:"change"}],serverList:[{required:!0,message:"请选择主机",trigger:"change"}]},createForm:{serverList:[],service:""},tasks:[],viewLogVisible:!1,logContent:"223234"}},mounted:function(){this.handleGetTask()},methods:{handleCurrentChange:function(e){this.page=e,this.handleGetTask()},selsChange:function(e){this.sels=e},getServer:function(){var e=this;Object(r.k)().then(function(t){e.optionsServer=t.data})},Service:function(){var e=this;Object(r.o)({all:1}).then(function(t){e.optionsService=t.data})},handleCreate:function(){this.createFormVisible=!0,this.getServer(),this.Service()},handleGetTask:function(){var e=this;this.loading=!0;var t={page:this.page,pagesize:this.pagesize};Object(r.p)(t).then(function(t){e.tasks=t.data.tasks,e.total=t.data.total,e.loading=!1;for(var n=0;n<t.data.tasks.length;n++)e.curentTaskStatus.push(t.data.tasks[n].task_status)}).catch(function(t){e.loading=!1})},onCreate:function(){var e=this;this.$refs.createForm.validate(function(t){t&&e.$confirm("确认提交吗？","提示",{}).then(function(){e.createLoading=!0;var t={serverList:e.createForm.serverList.toString(),service:e.createForm.service};Object(r.d)(t).then(function(t){e.handleGetTask(),e.createLoading=!1,e.createFormVisible=!1,e.$refs.createForm.resetFields()}).catch(function(){e.createLoading=!1,e.createFormVisible=!1,e.$refs.createForm.resetFields()})}).catch(function(){})})},handleDel:function(e,t){var n=this;this.$confirm("确认删除该记录吗?","提示",{type:"warning"}).then(function(){var e={task_id:t.task_id};Object(r.i)(e).then(function(e){n.handleGetTask(),n.loading=!1}).catch(function(){n.loading=!1})})},batchRemove:function(){var e=this,t=this.sels.map(function(e){return e.task_id}).toString();this.$confirm("确认删除选中记录吗？","提示",{type:"warning"}).then(function(){e.loading=!0;var n={task_id:t};Object(r.i)(n).then(function(t){e.loading=!1,e.handleGetTask()}).catch(function(){e.loading=!1})})},handleStart:function(){var e=this,t=this.sels.map(function(e){return e.task_id}).toString(),n=this.sels.map(function(e){return e.task_status}).toString();if("Running"in function(e){for(var t={},n=0;n<e.length;n++)t[e[n]]=" ";return t}(this.curentTaskStatus))this.$message({message:"有任务正在执行",type:"error",duration:2e3});else if("NewTask"===n){this.runLoading=!0;var a={task_id:t};Object(r.s)(a).then(function(t){e.runLoading=!1,2e4===t.data.code?(e.handleGetTask(),e.$message({message:t.data.msg,type:"success"})):(e.handleGetTask(),e.$message({message:t.data.msg,type:"error"}))}).catch(function(t){e.runLoading=!1,e.$message({message:t.message,type:"error"})})}else this.$message({message:"该任务已经执行过",type:"error",duration:2e3})},handleviewLog:function(e,t){var n=this;this.viewLogVisible=!0;var a={task_id:t.task_id};Object(r.t)(a).then(function(e){n.logContent=e.data}).catch(function(){n.logContent=""})},toviewlog:function(e,t){var n=this.$router.resolve({name:"viewlog",params:{task_id:t.task_id}}).href;window.open(n,"_blank")}}},i=(n("v1GH"),n("ZrdR")),s=Object(i.a)(a,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[n("el-form",{attrs:{inline:!0}},[n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:e.handleCreate}},[e._v("创建任务")])],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{loading:e.runLoading,disabled:1!==e.sels.length,type:"primary"},on:{click:e.handleStart}},[e._v("执行任务")])],1)],1)],1),e._v(" "),[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.tasks,"highlight-current-row":"",border:"",fit:"",stripe:""},on:{"selection-change":e.selsChange}},[n("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{type:"index",label:"序号",width:"50",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"srv_type",label:"安装服务",sortable:"",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"host_list",label:"主机列表",sortable:"",width:"180","header-align":"center"}}),e._v(" "),n("el-table-column",{attrs:{label:"创建时间",sortable:"",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.create_time))]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"task_id",label:"任务ID",sortable:"",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{label:"状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-tag",{attrs:{type:e._f("statusFilter")(t.row.task_status)}},[e._v(e._s(t.row.task_status))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(n){e.handleDel(t.$index,t.row)}}},[e._v("删除")]),e._v(" "),n("el-button",{attrs:{type:"text",size:"small"},on:{click:function(n){e.handleviewLog(t.$index,t.row)}}},[e._v("查看日志")])]}}])})],1)],e._v(" "),n("el-col",{staticClass:"toolbar toolbar-container",attrs:{span:24}},[n("el-button",{attrs:{disabled:0===e.sels.length,type:"danger"},on:{click:e.batchRemove}},[e._v("批量删除")]),e._v(" "),n("el-pagination",{staticStyle:{float:"right"},attrs:{total:e.total,"page-size":e.pagesize,layout:"prev, pager, next"},on:{"current-change":e.handleCurrentChange}})],1),e._v(" "),[n("el-dialog",{attrs:{visible:e.createFormVisible,"close-on-click-modal":!1,title:"创建任务",width:"40%"},on:{"update:visible":function(t){e.createFormVisible=t}}},[n("el-form",{ref:"createForm",attrs:{model:e.createForm,rules:e.createFormRules,"status-icon":"","label-width":"120px"}},[n("el-form-item",{attrs:{label:"请选择服务:",prop:"service"}},[n("el-select",{attrs:{filterable:"",clearable:"",size:"medium",placeholder:"请选择服务"},model:{value:e.createForm.service,callback:function(t){e.$set(e.createForm,"service",t)},expression:"createForm.service"}},e._l(e.optionsService,function(e){return n("el-option",{key:e.service,attrs:{label:e.service,value:e.service}})}))],1),e._v(" "),n("el-form-item",{attrs:{label:"请选择主机IP:",prop:"serverList"}},[n("el-select",{attrs:{multiple:"",filterable:"",clearable:"",placeholder:"请选择IP"},model:{value:e.createForm.serverList,callback:function(t){e.$set(e.createForm,"serverList",t)},expression:"createForm.serverList"}},e._l(e.optionsServer,function(e){return n("el-option",{key:e.host_id,attrs:{label:e.ip,value:e.host_id}})}))],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{loading:e.createLoading,type:"primary"},nativeOn:{click:function(t){return e.onCreate(t)}}},[e._v("提交")]),e._v(" "),n("el-button",{on:{click:function(t){e.createFormVisible=!1}}},[e._v("取消")])],1)],1)],1)],e._v(" "),n("el-scrollbar",{staticStyle:{height:"100%"}},[n("el-dialog",{attrs:{visible:e.viewLogVisible,title:"任务日志",width:"60%"},on:{"update:visible":function(t){e.viewLogVisible=t}}},[n("el-input",{attrs:{rows:15,readonly:"true",type:"textarea"},model:{value:e.logContent,callback:function(t){e.logContent=t},expression:"logContent"}})],1)],1)],2)},[],!1,null,"2926625b",null);s.options.__file="task.vue";t.default=s.exports},v1GH:function(e,t,n){"use strict";var r=n("C4tA");n.n(r).a}}]);